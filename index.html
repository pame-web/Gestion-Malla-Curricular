<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Datos con Google Sheets</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        form { margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Gestión de Datos</h1>

    <form id="dataForm">
        <input type="text" id="name" placeholder="Nombre" required>
        <input type="email" id="email" placeholder="Correo" required>
        <button type="submit">Agregar</button>
    </form>

    <form id="searchForm">
        <input type="text" id="searchTerm" placeholder="Buscar por nombre">
        <button type="button" onclick="searchData()">Buscar</button>
        <button type="button" onclick="clearFilter()">Limpiar</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Correo</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="dataTable">
            <!-- Aquí se añadirán las filas de datos -->
        </tbody>
    </table>

    <script src="app.js"></script>
    <script>
        const form = document.getElementById('dataForm');
        const dataTable = document.getElementById('dataTable');
        
        // Cargar los datos cuando se carga la página
        window.onload = function() {
            loadData();
        };

        // Función para agregar datos a Google Sheets
        form.addEventListener('submit', function (event) {
            event.preventDefault();
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;

            fetch(`${apiUrl}?action=create&name=${name}&email=${email}`)
                .then(response => response.text())
                .then(data => {
                    alert(data);
                    form.reset();
                    loadData();
                });
        });

        // Función para buscar datos por nombre en Google Sheets
        function searchData() {
            const searchTerm = document.getElementById('searchTerm').value.trim().toLowerCase();

            fetch(`${apiUrl}?action=read`)
                .then(response => response.json())
                .then(data => {
                    dataTable.innerHTML = ''; // Limpiar la tabla antes de cargar nuevos datos
                    data.forEach((row, index) => {
                        let found = false;
                        row.forEach(cell => {
                            if (cell.toLowerCase().includes(searchTerm)) {
                                found = true;
                            }
                        });
                        if (found) {
                            const newRow = document.createElement('tr');
                            newRow.innerHTML = `
                                <td>${index + 1}</td>
                                <td>${row[0]}</td>
                                <td>${row[1]}</td>
                                <td>
                                    <button onclick="editRow(${index + 1}, '${row[0]}', '${row[1]}')">Editar</button>
                                    <button onclick="deleteRow(${index + 1})">Eliminar</button>
                                </td>
                            `;
                            dataTable.appendChild(newRow);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error al buscar datos:', error);
                    alert('Ocurrió un error al buscar datos. Por favor, intenta nuevamente.');
                });
        }

        // Función para limpiar el filtro y mostrar todos los datos
        function clearFilter() {
            document.getElementById('searchTerm').value = ''; // Limpiar el campo de búsqueda
            loadData(); // Volver a cargar todos los datos
        }
    </script>
</body>
</html>
